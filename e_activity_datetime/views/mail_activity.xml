<?xml version='1.0' encoding='utf-8'?>
<odoo>
    <record id="e_datetime_inherit_mail_activity" model="ir.ui.view">
        <field name="name">mail.activity.view.form.inherit</field>
        <field name="model">mail.activity</field>
        <field name="inherit_id" ref="mail.mail_activity_view_form_popup"/>
        <field name="arch" type="xml">
            <xpath expr="//field[@name='date_deadline']" position="before">
                <field name="all_day"></field>
                <field name="datetime_start" invisible="all_day"/>
                <field name="datetime_deadline" invisible="all_day" required="not all_day"></field>
                <field name="datetime_duration" invisible="all_day or not datetime_duration" widget="float_time" />
            </xpath>
            <xpath expr="//field[@name='date_deadline']" position="attributes">
                <attribute name="invisible">not all_day</attribute>
            </xpath>
        </field>
    </record>

    <record id="e_datetime_mail_activity_list" model="ir.ui.view">
        <field name="name">mail.activity.view.list.inherit</field>
        <field name="model">mail.activity</field>
        <field name="inherit_id" ref="mail.mail_activity_view_tree_open_target"/>
        <field name="arch" type="xml">
            <xpath expr="//field[@name='date_deadline']" position="attributes">
                <attribute name="widget">eremaining_days_datetime</attribute>
            </xpath>
            <xpath expr="//field[@name='date_deadline']" position="before">
                <field name="datetime_start" invisible="1"></field>
                <field name="datetime_deadline" invisible="1"></field>
                <field name="all_day" invisible="1"></field>
            </xpath>
        </field>
    </record>

    <record id="e_datetime_mail_activity_kanban" model="ir.ui.view">
        <field name="name">mail.activity.view.kanban.inherit</field>
        <field name="model">mail.activity</field>
        <field name="inherit_id" ref="mail.mail_activity_view_kanban_open_target"/>
        <field name="arch" type="xml">
            <xpath expr="//field[@name='date_deadline']" position="attributes">
                <attribute name="widget">eremaining_days_datetime</attribute>
            </xpath>
            <xpath expr="//field[@name='icon']" position="after">
                <field name="datetime_start" invisible="1"></field>
                <field name="datetime_deadline" invisible="1"></field>
                <field name="all_day" invisible="1"></field>
            </xpath>
        </field>
    </record>

    <record id="e_datetime_mail_activity_calendary" model="ir.ui.view">
        <field name="name">mail.activity.view.kanban.inherit</field>
        <field name="model">mail.activity</field>
        <field name="inherit_id" ref="mail.mail_activity_view_calendar"/>
        <field name="arch" type="xml">
            <xpath expr="//calendar" position="attributes">
                <attribute name="date_start">datetime_calendary</attribute>
            </xpath>
            <xpath expr="//field[@name='date_deadline']" position="replace">
                <field name="all_day" invisible="1"/>
                <field name="date_deadline" invisible="not all_day"/>
                <field name="datetime_start" invisible="all_day or not datetime_start"/>
                <field name="datetime_deadline" invisible="all_day or datetime_start == datetime_deadline"/>
            </xpath>
        </field>
    </record>
</odoo>